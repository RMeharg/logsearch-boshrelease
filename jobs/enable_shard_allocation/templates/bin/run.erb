#!/bin/bash

set -e

<%
  elasticsearch_addrs = nil
  respond_to?(:if_link) && if_link("elasticsearch") do |elasticsearch|
    elasticsearch_addrs = link('elasticsearch').instances[0].address
  end.else do
    elasticsearch_addrs = p("enable_shard_allocation.elasticsearch.master_node")
  end
%>

curl -s \
    -X PUT \
    -d '{"transient":{"cluster.routing.allocation.enable":"all"}}' \
    '<%= elasticsearch_addrs %>:9200/_cluster/settings' \
    > /dev/null
